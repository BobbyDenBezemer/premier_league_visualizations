<!DOCTYPE html>
<!-- saved from url=(0037)http://127.0.0.1:8000/line_graph.html -->
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Line graph</title>

    <!-- This is your script file, write your functions in main.js -->
    <script src="http://d3js.org/d3.v3.min.js"></script>

 <style>
.rect {
  fill: steelblue;
}

.text {
  fill: white;
  font: 10px sans-serif;
  text-anchor: end;
}

.menu {
	margin-top: 10px;
	margin-left: 40px;
	font: 14px sans-serif;
	font-weight: bold;
}

</style>
<body>
<script>
"use strict";

// declare the margins
var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;


// create an svg element
var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  	.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// Load in the data
d3.csv("./data/yearly_teams.csv", function(error, data) {
	data.forEach(function(d) {
    	d.Points =+ d.Points;
    	d.Season =+ d.Season;
  	});

	// create a unique function
	function isUnique(data, variable){
    	var number_of_years = new Array()
    	var length = data.length;

    	for (var i = 0; i < length; i++){
    		if (number_of_years.indexOf(data[i][variable]) == -1 && !isNaN(data[i][variable])){
    			number_of_years.push(data[i][variable]);
    		}
    	}
    	return number_of_years;
    }

    console.log(data);
    //var barHeight = height / 22;

    // calculate the number of years in dataset and use this for the height variable
    var years = isUnique(data, "Season");
    var number_of_years = years.length;

    // make a draw function
    function draw(data, year) {

    	// make a linear x scale
		var x = d3.scale.linear()
    		.domain([0, d3.max(data, function(d){return d.Points})])
    		.range([0, width]);

    	// calculate
    	console.log(data);
    	var barHeight = height / 22;
		
		// bind the data
		var bar = svg.selectAll("g")
    		.data(data.filter(function(d){return d.Season === year}))
  			.enter()
  			.append("g")
  			.filter(function(d){ return d.Season === year})
    		.attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"});

    	// for every data point append a rectangle
    	bar.append("rect")
    		.attr("class", "rect")
            .attr("width", function(d){return x(d.Points);})
    		.attr("height", barHeight - 1);

    	// for every data point append some text
    	bar.append("text")
    		.attr("class", "text")
    		.attr("x", function(d) { return x(d.Points) - 130; })
    		.attr("y", barHeight / 2)
    		.attr("dy", ".35em")
    		.text(function(d) { return d.Teams; });    		

    	// remove old elements
    	//bar.exit().remove();
    };

    window.onload = draw(data, 1992);

    // make a drop down menu 
    var menu = d3.select("body")
		.append("p")
    	.attr("class", "menu")
    	.text("Select the season that you want to display")
    	.attr("name", "country-list")

    // append to the dropdown menu the options based on the year data points
    menu.append("select")
    	.attr("id", "dropdown")
    	.selectAll("option")
    	.data(years)
    	.enter()
    	.append("option")
    	.text(function(d, i) {return years[i];})
    	.attr("value", function (d, i) { return years[i];});

    // adding event listener to the dropdown menu
    d3.select("#dropdown")
    	.on("change", function(){
    		var newData = eval(d3.select(this).property('value'));
    		console.log(newData);
    		draw(data, newData);
    	});

   	// TODO: Update the data points based on the choice made in the dropdown menu

    //var bar = svg.selectAll(".rect")
});
	

</script>
</body>
</html>